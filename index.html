<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            padding: 20px;
        }
        
        .calculator {
            width: 100%;
            max-width: 400px;
            background: #1e293b;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }
        
        .display {
            background: #0f172a;
            color: white;
            padding: 25px 20px;
            text-align: right;
            position: relative;
        }
        
        .previous-operand {
            min-height: 24px;
            font-size: 18px;
            color: #94a3b8;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .current-operand {
            min-height: 40px;
            font-size: 36px;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .memory-indicator {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 14px;
            color: #60a5fa;
        }
        
        .mode-indicator {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 14px;
            color: #34d399;
        }
        
        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1px;
            background: #334155;
            padding: 1px;
        }
        
        button {
            border: none;
            outline: none;
            padding: 18px 5px;
            font-size: 18px;
            background: #1e293b;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        button:hover {
            background: #2d3748;
        }
        
        button:active {
            background: #0f172a;
            transform: scale(0.95);
        }
        
        .number {
            background: #1e293b;
        }
        
        .operation {
            background: #3b82f6;
        }
        
        .function {
            background: #7c3aed;
        }
        
        .memory {
            background: #ef4444;
        }
        
        .equals {
            background: #10b981;
            grid-column: span 2;
        }
        
        .clear {
            background: #f59e0b;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: #94a3b8;
            font-size: 14px;
            background: #0f172a;
        }
        
        .footer a {
            color: #60a5fa;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="display">
            <div class="memory-indicator" id="memoryIndicator">M: 0</div>
            <div class="mode-indicator" id="modeIndicator">DEG</div>
            <div class="previous-operand" id="previousOperand"></div>
            <div class="current-operand" id="currentOperand">0</div>
        </div>
        
        <div class="buttons">
            <button class="memory" data-action="memory-clear">MC</button>
            <button class="memory" data-action="memory-recall">MR</button>
            <button class="memory" data-action="memory-add">M+</button>
            <button class="memory" data-action="memory-subtract">M-</button>
            <button class="function" data-action="toggle-mode">DEG/RAD</button>
            
            <button class="function" data-action="square">x²</button>
            <button class="function" data-action="power">x^y</button>
            <button class="function" data-action="sqrt">√</button>
            <button class="function" data-action="factorial">x!</button>
            <button class="function" data-action="reciprocal">1/x</button>
            
            <button class="function" data-action="sin">sin</button>
            <button class="function" data-action="cos">cos</button>
            <button class="function" data-action="tan">tan</button>
            <button class="function" data-action="log">log</button>
            <button class="function" data-action="ln">ln</button>
            
            <button class="function" data-action="pi">π</button>
            <button class="function" data-action="e">e</button>
            <button class="function" data-action="exp">exp</button>
            <button class="function" data-action="percentage">%</button>
            <button class="clear" data-action="clear-entry">CE</button>
            
            <button class="clear" data-action="clear">C</button>
            <button class="function" data-action="backspace">⌫</button>
            <button class="operation" data-operation="/">÷</button>
            <button class="operation" data-operation="*">×</button>
            
            <button class="number" data-number="7">7</button>
            <button class="number" data-number="8">8</button>
            <button class="number" data-number="9">9</button>
            <button class="operation" data-operation="-">−</button>
            
            <button class="number" data-number="4">4</button>
            <button class="number" data-number="5">5</button>
            <button class="number" data-number="6">6</button>
            <button class="operation" data-operation="+">+</button>
            
            <button class="number" data-number="1">1</button>
            <button class="number" data-number="2">2</button>
            <button class="number" data-number="3">3</button>
            <button class="operation" data-operation="=">=</button>
            
            <button class="number" data-action="negate">±</button>
            <button class="number" data-number="0">0</button>
            <button class="number" data-action="decimal">.</button>
        </div>
        
        <div class="footer">
            Научный калькулятор | <a href="#" id="helpBtn">Помощь</a>
        </div>
    </div>
    
    <script>
        const calculator = {
            currentOperand: '0',
            previousOperand: '',
            operation: undefined,
            memory: 0,
            isRadians: false,
            overwrite: true
        };
        
        const currentOperandElement = document.getElementById('currentOperand');
        const previousOperandElement = document.getElementById('previousOperand');
        const memoryIndicator = document.getElementById('memoryIndicator');
        const modeIndicator = document.getElementById('modeIndicator');
        const helpBtn = document.getElementById('helpBtn');
        
        function updateDisplay() {
            currentOperandElement.textContent = calculator.currentOperand;
            
            if (calculator.operation) {
                previousOperandElement.textContent = 
                    `${calculator.previousOperand} ${getOperationSymbol(calculator.operation)}`;
            } else {
                previousOperandElement.textContent = calculator.previousOperand;
            }
            
            memoryIndicator.textContent = `M: ${calculator.memory}`;
            modeIndicator.textContent = calculator.isRadians ? 'RAD' : 'DEG';
        }
        
        function getOperationSymbol(operation) {
            const symbols = {
                '+': '+',
                '-': '−',
                '*': '×',
                '/': '÷',
                '^': '^',
                '=': '='
            };
            return symbols[operation] || operation;
        }
        
        function appendNumber(number) {
            if (calculator.overwrite) {
                calculator.currentOperand = number;
                calculator.overwrite = false;
            } else {
                if (calculator.currentOperand.length >= 15) return;
                
                if (calculator.currentOperand === '0' && number === '0') return;
                
                if (calculator.currentOperand === '0' && number !== '.') {
                    calculator.currentOperand = number;
                } else {
                    calculator.currentOperand += number;
                }
            }
        }
        
        function chooseOperation(operation) {
            if (calculator.currentOperand === '') return;
            
            if (calculator.previousOperand !== '') {
                compute();
            }
            
            calculator.operation = operation;
            calculator.previousOperand = calculator.currentOperand;
            calculator.currentOperand = '';
        }
        
        function compute() {
            let computation;
            const prev = parseFloat(calculator.previousOperand);
            const current = parseFloat(calculator.currentOperand);
            
            if (isNaN(prev) return;
            
            switch (calculator.operation) {
                case '+':
                    computation = prev + current;
                    break;
                case '-':
                    computation = prev - current;
                    break;
                case '*':
                    computation = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        computation = 'Ошибка';
                    } else {
                        computation = prev / current;
                    }
                    break;
                case '^':
                    computation = Math.pow(prev, current);
                    break;
                default:
                    return;
            }
            
            if (typeof computation === 'number') {
                computation = Math.round(computation * 10000000000) / 10000000000;
            }
            
            calculator.currentOperand = computation.toString();
            calculator.operation = undefined;
            calculator.previousOperand = '';
            calculator.overwrite = true;
        }
        
        function clear() {
            calculator.currentOperand = '0';
            calculator.previousOperand = '';
            calculator.operation = undefined;
            calculator.overwrite = true;
        }
        
        function clearEntry() {
            calculator.currentOperand = '0';
            calculator.overwrite = true;
        }
        
        function backspace() {
            if (calculator.currentOperand.length === 1 || 
                (calculator.currentOperand.length === 2 && calculator.currentOperand.startsWith('-'))) {
                calculator.currentOperand = '0';
                calculator.overwrite = true;
            } else {
                calculator.currentOperand = calculator.currentOperand.slice(0, -1);
            }
        }
        
        function addDecimal() {
            if (calculator.overwrite) {
                calculator.currentOperand = '0.';
                calculator.overwrite = false;
                return;
            }
            
            if (!calculator.currentOperand.includes('.')) {
                calculator.currentOperand += '.';
            }
        }
        
        function negate() {
            if (calculator.currentOperand === '0') return;
            
            if (calculator.currentOperand.startsWith('-')) {
                calculator.currentOperand = calculator.currentOperand.slice(1);
            } else {
                calculator.currentOperand = '-' + calculator.currentOperand;
            }
        }
        
        function applyFunction(func) {
            const current = parseFloat(calculator.currentOperand);
            if (isNaN(current)) return;
            
            let result;
            
            switch (func) {
                case 'square':
                    result = current * current;
                    break;
                case 'sqrt':
                    if (current < 0) {
                        result = 'Ошибка';
                    } else {
                        result = Math.sqrt(current);
                    }
                    break;
                case 'reciprocal':
                    if (current === 0) {
                        result = 'Ошибка';
                    } else {
                        result = 1 / current;
                    }
                    break;
                case 'factorial':
                    if (current < 0 || !Number.isInteger(current)) {
                        result = 'Ошибка';
                    } else {
                        result = 1;
                        for (let i = 2; i <= current; i++) {
                            result *= i;
                        }
                    }
                    break;
                case 'sin':
                    const rad = calculator.isRadians ? current : current * Math.PI / 180;
                    result = Math.sin(rad);
                    break;
                case 'cos':
                    const radCos = calculator.isRadians ? current : current * Math.PI / 180;
                    result = Math.cos(radCos);
                    break;
                case 'tan':
                    const radTan = calculator.isRadians ? current : current * Math.PI / 180;
                    if (Math.abs(Math.cos(radTan)) < 1e-10) {
                        result = 'Ошибка';
                    } else {
                        result = Math.tan(radTan);
                    }
                    break;
                case 'log':
                    if (current <= 0) {
                        result = 'Ошибка';
                    } else {
                        result = Math.log10(current);
                    }
                    break;
                case 'ln':
                    if (current <= 0) {
                        result = 'Ошибка';
                    } else {
                        result = Math.log(current);
                    }
                    break;
                case 'exp':
                    result = Math.exp(current);
                    break;
                case 'pi':
                    result = Math.PI;
                    break;
                case 'e':
                    result = Math.E;
                    break;
                case 'percentage':
                    result = current / 100;
                    break;
                case 'power':
                    calculator.operation = '^';
                    calculator.previousOperand = calculator.currentOperand;
                    calculator.currentOperand = '';
                    return;
                default:
                    return;
            }
            
            if (typeof result === 'number') {
                result = Math.round(result * 10000000000) / 10000000000;
            }
            
            calculator.currentOperand = result.toString();
            calculator.overwrite = true;
        }
        
        function memoryAction(action) {
            const current = parseFloat(calculator.currentOperand);
            if (isNaN(current)) return;
            
            switch (action) {
                case 'memory-add':
                    calculator.memory += current;
                    break;
                case 'memory-subtract':
                    calculator.memory -= current;
                    break;
                case 'memory-recall':
                    calculator.currentOperand = calculator.memory.toString();
                    calculator.overwrite = true;
                    break;
                case 'memory-clear':
                    calculator.memory = 0;
                    break;
            }
        }
        
        function toggleMode() {
            calculator.isRadians = !calculator.isRadians;
        }
        
        function showHelp() {
            alert("Научный калькулятор\n\n" +
                  "Основные функции:\n" +
                  "- Сложение, вычитание, умножение, деление\n" +
                  "- Возведение в степень (x^y), квадрат (x²), корень (√)\n" +
                  "- Тригонометрические функции (sin, cos, tan)\n" +
                  "- Логарифмы (log, ln), экспонента (exp)\n" +
                  "- Факториал (x!), обратное число (1/x)\n" +
                  "- Проценты (%), смена знака (±)\n\n" +
                  "Память:\n" +
                  "MC - очистить память\n" +
                  "MR - вызвать из памяти\n" +
                  "M+ - добавить к памяти\n" +
                  "M- - вычесть из памяти\n\n" +
                  "DEG/RAD - переключение между градусами и радианами");
        }
        
        document.querySelector('.buttons').addEventListener('click', (event) => {
            if (!event.target.matches('button')) return;
            
            const button = event.target;
            
            if (button.dataset.number) {
                appendNumber(button.dataset.number);
                updateDisplay();
                return;
            }
            
            if (button.dataset.operation) {
                chooseOperation(button.dataset.operation);
                updateDisplay();
                return;
            }
            
            if (button.dataset.action) {
                const action = button.dataset.action;
                
                switch (action) {
                    case 'clear':
                        clear();
                        break;
                    case 'clear-entry':
                        clearEntry();
                        break;
                    case 'backspace':
                        backspace();
                        break;
                    case 'decimal':
                        addDecimal();
                        break;
                    case 'negate':
                        negate();
                        break;
                    case 'equals':
                        compute();
                        break;
                    case 'toggle-mode':
                        toggleMode();
                        break;
                    default:
                        if (action.startsWith('memory')) {
                            memoryAction(action);
                        } else {
                            applyFunction(action);
                        }
                }
                
                updateDisplay();
            }
        });
        
        helpBtn.addEventListener('click', showHelp);
        
        updateDisplay();
    </script>
</body>
</html>
